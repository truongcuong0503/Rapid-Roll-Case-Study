<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button onclick="start()">Start</button>
    <button onclick="stop()">Stop</button>
    <center>
    <canvas width="400px" height="700px" style="border: 1px solid;" id="canvas"></canvas>
    </center>
    
</body>
<script>
    class Brick {
        x
        y
        width
        height
        color
        constructor(x, y, width, height, color ) {
            this.x = x
            this.y = y
            this.width = width
            this.height = height
            this.color = color
        }       

        drawBrick() {
            let ctx = document.getElementById("canvas").getContext("2d")
            ctx.beginPath()
            ctx.fillStyle = this.color
            ctx.fillRect(this.x, this.y, this.width, this.height)
            ctx.closePath()
        }
    }

    class Ball {
        x
        y
        radius
        color
        constructor(x, y, radius, color) {
            this.x = x
            this.y = y
            this.radius = radius
            this.color = color
        }

        drawBall() {
            let ctx = document.getElementById("canvas").getContext("2d")
            ctx.beginPath()
            ctx.fillStyle = this.color
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2)
            ctx.fill()
            ctx.closePath()
        }

        isCheckCollision(brick) {
            let Ax = this.x
            let Ay = this.y

            let brick_left = brick.x;
            let brick_top = brick.y;
            let brick_right = brick.x + brick.width;
            let brick_bottom = brick.y + brick.height;

            if (this.x < brick_left) {
                Ax = brick_left
            } else if (this.x > brick_right) {
                Ax = brick_right
            }

            if (this.y < brick_top) {
                Ay = brick_top
            } else if (this.y > brick_bottom) {
                Ay = brick_bottom
            }

            let dx = this.x - Ax
            let dy = this.y - Ay

            return (Math.pow(dx, 2) * Math.pow(dy, 2)) <= Math.pow(this.radius, 2)
        }
    }
    let canvas = document.getElementById("canvas")
    let ctx = canvas.getContext("2d")
    let ball = new Ball(canvas.width / 2, canvas.height / 2, 10, "black")
    let brickDie = new Brick(0, 0, 400, 100, "red")
    let brick1 = new Brick((Math.random() * 300), 720, 100, 10, "green")
    let brick2 = new Brick((Math.random() * 300), 800, 100, 10, "green")
    let brick3 = new Brick((Math.random() * 300), 880, 100, 10, "green")
    let brick4 = new Brick((Math.random() * 300), 960, 100, 10, "green")
    let brick5 = new Brick((Math.random() * 300), 1040, 100, 10, "green")
    let brick6 = new Brick((Math.random() * 300), 1120, 100, 10, "green")
    let brick7 = new Brick((Math.random() * 300), 1200, 100, 10, "green")
    let brick8 = new Brick((Math.random() * 300), 1280, 100, 10, "green")
    let brick9 = new Brick((Math.random() * 300), 1360, 100, 10, "green")
    let bricks = [brick1, brick2, brick3, brick4, brick5, brick6, brick7,  brick8]
    

    function getBrick() {
        for (let i = 0; i < bricks.length; i++) {
            bricks[i].y -= 5
            bricks[i].drawBrick()
        }
    }

    function deleteAndAddBrick() {
        
    }

    function playGame() {
        for (let i = 0; i < bricks.length; i++) {
            bricks[i] += ball.isCheckCollision(bricks[i])
        }
        // if (ball.isCheckCollision(bricks)) {
            // game()
        // }
        game()
    }

    function speedBall() {
            ball.y -= 5
    }

    function speedBallDown() {
        // if (ball.x < 90 || ball.x > 210) {
            ball.y += 10
        }
    // }

    function moveLeft(ball) {
        ball.x -= 5
    }

    function moveRight(ball) {
        ball.x += 5
    }

    function moveSelection(evt) {
        switch(evt.keyCode) {
            case 37:
                moveLeft(ball);
                break;
            case 39:
                moveRight(ball);
                break;
        }
    }

    window.addEventListener("keydown", moveSelection)

    function game() {
        ctx.clearRect(0, 0, 400, 700)
        getBrick()
        // speedBallDown()
        checkWin()
        ball.drawBall()
        brickDie.drawBrick()
    }

    function checkWin() {
        if (ball.y <= 100 || ball.y >= 720) {
            alert("lose")
        }
    }

    //hcn di chuyá»ƒn
    // function playGame() {
    //     ctx.clearRect(0, 0, 400, 700)
    //     // if (rect.y > 0) {
    //         speedBrick(rect)
    //         rect.drawRect()
    //     // } else {
    //     //     speedRect(newRect)
    //     //     newRect.drawRect()
    //     // }
    //     speedBallDown()
    //     checkWin()
    //     rectBrick.drawBrick()
    //     ball.drawBall()
    // }

    function start() {
        interval = setInterval(playGame, 150)
    }

    function stop() {
        clearInterval(interval)
    }
    
</script>
</html>
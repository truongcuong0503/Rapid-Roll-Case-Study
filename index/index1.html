<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button onclick="start()">Start</button>
    <button onclick="stop()">Stop</button>
    <center>
    <canvas width="400px" height="700px" style="border: 1px solid;" id="canvas"></canvas>
    </center>
    
</body>
<script>
    class Brick {
        x
        y
        width
        height
        color
        constructor(x, y, width, height, color ) {
            this.x = x
            this.y = y
            this.width = width
            this.height = height
            this.color = color
        }       

        drawBrick() {
            let ctx = document.getElementById("canvas").getContext("2d")
            ctx.beginPath()
            ctx.fillStyle = this.color
            ctx.fillRect(this.x, this.y, this.width, this.height)
            ctx.closePath()
        }
    }

    class Ball {
        x
        y
        radius
        color
        constructor(x, y, radius, color) {
            this.x = x
            this.y = y
            this.radius = radius
            this.color = color
        }

        drawBall() {
            let ctx = document.getElementById("canvas").getContext("2d")
            ctx.beginPath()
            ctx.fillStyle = this.color
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2)
            ctx.fill()
            ctx.closePath()
        }
    }

    let canvas = document.getElementById("canvas")
    let ctx = canvas.getContext("2d")
    let ball = new Ball(canvas.width / 2, canvas.height / 2, 10, "black")
    let brickDie = new Brick(0, 0, 400, 100, "red")
    let brick1 = new Brick((Math.random() * 300), 720, 100, 10, "green")
    let brick2 = new Brick((Math.random() * 300), 800, 100, 10, "green")
    let brick3 = new Brick((Math.random() * 300), 880, 100, 10, "green")
    let brick4 = new Brick((Math.random() * 300), 960, 100, 10, "green")
    let brick5 = new Brick((Math.random() * 300), 1040, 100, 10, "green")
    let brick6 = new Brick((Math.random() * 300), 1120, 100, 10, "green")
    let brick7 = new Brick((Math.random() * 300), 1200, 100, 10, "green")
    let brick8 = new Brick((Math.random() * 300), 1280, 100, 10, "green")
    let brick9 = new Brick((Math.random() * 300), 1360, 100, 10, "green")
    let bricks = [brick1, brick2, brick3, brick4, brick5, brick6, brick7,  brick8, brick9]
    

    function getBrick() {
        for (let i = 0; i < bricks.length; i++) {
            bricks[i].y -= 5
            bricks[i].drawBrick()
            
        }
    }

    function deleteAndAddBrick() {
        for (let i = 0; i < bricks.length; i++) {
            if (bricks[i].y <= brickDie.y) {
                bricks[i].y = 720;
            }
        }
    }

    function speedBall() {
            ball.y -= 5
    }

    function speedBallDown() {
        // if (ball.x < 90 || ball.x > 210) {
            ball.y += 5
        }
    // }

    function moveLeft(ball) {
        if (ball.x == ball.radius) {
            ball.x += 0
        } else {
            ball.x -= 5
        }
        
    }

    function moveRight(ball) {
        if (ball.x == (canvas.width - ball.radius)) {
            ball.x += 0
        } else {
            ball.x += 5
        }
        // ball.x += 5
    }

    function moveSelection(evt) {
        switch(evt.keyCode) {
            case 37:
                moveLeft(ball);
                break;
            case 39:
                moveRight(ball);
                break;
        }
    }

    window.addEventListener("keydown", moveSelection)

    function drawGame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        getBrick()
        // if ()
        speedBallDown()
        // Check va chạm
        // isBallCollideAnyBrick(ball, bricks);
        isCheckCollision()
        deleteAndAddBrick();
        checkWin()
        ball.drawBall()
        brickDie.drawBrick()
        
    }

    function isCheckCollision() {
        for (let i = 0; i < bricks.length; i++) {
            if (ball.x + ball.radius >= bricks[i].x && ball.x + ball.radius <= bricks[i].x + bricks[i].width && ball.y + ball.radius >= bricks[i].y - bricks[i].height) {
                ball.y -= 5
            }
        }
        
    }

    function checkWin() {
        if (ball.y <= 100 || ball.y >= 720) {
            alert("lose")
        }
    }

    //hcn di chuyển
    // function playGame() {
    //     ctx.clearRect(0, 0, 400, 700)
    //     // if (rect.y > 0) {
    //         speedBrick(rect)
    //         rect.drawRect()
    //     // } else {
    //     //     speedRect(newRect)
    //     //     newRect.drawRect()
    //     // }
    //     speedBallDown()
    //     checkWin()
    //     rectBrick.drawBrick()
    //     ball.drawBall()
    // }

    function start() {
        interval = setInterval(drawGame, 1000/50)
    }

    function stop() {
        clearInterval(interval)
    }
    
</script>
</html>